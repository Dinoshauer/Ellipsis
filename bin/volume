#!/bin/bash

source /home/k/.config/lemonbar/panel.cfg

ACTION=$1
AMOUNT=$2

volume () {
  vol=$(pamixer --get-volume)
  vol="${vol//%}"

  icon=$VOLUME_FULL_ICON
  color=$WHITE

  if [[ $vol -lt 40 && $vol -gt 1 ]]; then
    icon="$VOLUME_MED_ICON"
  elif [[ $vol -eq 0 ]]; then
    icon="$VOLUME_LOW_ICON"
  fi

  if amixer get $dev | egrep "off" &>/dev/null; then
    icon=$VOLUME_MUTE_ICON
    color=$BOLD_RED
  fi

  printf "%s %-5s\n" "%{B#FF${BOLD_BLACK}} %{F#FF${color}}%{A:volume toggle:}${icon} %{A}%{B-}" "%{F#FF${BOLD_WHITE}}%{A:pavucontrol:}$vol%{A}"
}

get_volume () {
  printf "%s" "$(pamixer --get-volume)"
}

if [[ $# -ne 0 ]]; then
    if [ "$ACTION" == "toggle" ]; then
        if pamixer --get-mute | grep "false" >> /dev/null; then
            pamixer --mute
            dunstify -a "Volume" -u NORMAL -h "int:value:$(get_volume)" "" "${VOLUME_MUTE_ICON}"
            echo "Muted audio"
        else
            pamixer --unmute
            dunstify -a "Volume" -u NORMAL -h "int:value:$(get_volume)" "" "${VOLUME_FULL_ICON}"
            echo "Unmuted audio"
        fi
    else
        if [ "$ACTION" == "decrease" ]; then
            pamixer --allow-boost --decrease $AMOUNT
        else
            pamixer --allow-boost --increase $AMOUNT
        fi

        pamixer --unmute

        vol=$(get_volume)
        vol="${vol//%}"

        icon=$VOLUME_FULL_ICON

        if [[ $vol -lt 40 && $vol -gt 1 ]]; then
          icon="$VOLUME_MED_ICON"
        elif [[ $vol -eq 0 ]]; then
          icon="$VOLUME_LOW_ICON"
        fi

        dunstify -a "Volume" -u NORMAL -h "int:value:$(get_volume)" "asd" "${icon}"
    fi
fi

echo "V$(volume)%" > /tmp/bspwm-bar
